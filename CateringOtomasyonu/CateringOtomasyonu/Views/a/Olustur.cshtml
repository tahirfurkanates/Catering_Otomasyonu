@model CateringOtomasyonu.dal.Randevular
@{
    ViewData["Title"] = "Randevu Oluştur";
    var rol = Context.Session.GetString("Rol");
    if(rol=="Admin")
    {
        Layout = "~/Views/Shared/_AdminLayout.cshtml";
    }
    else
    {
        Layout = "~/Views/Shared/_VeterinerLayout.cshtml";
        
    }
    var veterinerler = ViewBag.Veterinerler as List<CateringOtomasyonu.dal.Veterinerler>;
}

<h2>Randevu Oluştur</h2>
@if (ViewBag.Mesaj != null)
{
    <div class="alert alert-success">@ViewBag.Mesaj</div>
}

<form asp-action="Olustur" method="post">

    @if (rol == "Admin")
    {
        <div class="form-group">
            <label>Veteriner Seçin</label>
            <select asp-for="VeterinerId" class="form-control" required>
                <option value="">-- Veteriner Seçin --</option>
                @foreach (var vet in veterinerler)
                {
                    <option value="@vet.VeterinerId">@vet.Ad @vet.Soyad</option>
                }
            </select>
        </div>
    }

    <div class="form-group">
        <label>Tarih</label>
        <input id="tarihSec" name="Tarih" type="date" class="form-control" required />
    </div>

    <div class="form-group">
        <label>Saat</label>
        <select id="saatSec" name="saat" class="form-control" required>
            <option>-- Önce Tarih Seçin --</option>
        </select>
    </div>

    <div class="form-group">
        <label>Notlar</label>
        <textarea asp-for="Notlar" class="form-control"></textarea>
    </div>

    <button type="submit" class="btn btn-success">Kaydet</button>
</form>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $('#tarihSec').on('change', function () {
            var tarih = $(this).val();
            $('#saatSec').empty();

            if (tarih) {
                $.getJSON('/Randevu/BosSaatler?tarih=' + tarih, function (data) {
                    if (data.length === 0) {
                        $('#saatSec').append($('<option>').text("Boş saat yok").attr('disabled', true));
                    } else {
                        data.forEach(function (saat) {
                            $('#saatSec').append($('<option>').text(saat).val(saat));
                        });
                    }
                });
            }
        });
    </script>
}
