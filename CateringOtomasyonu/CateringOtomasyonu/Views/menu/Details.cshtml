@model CateringOtomasyonu.ViewModels.MenuDetailsVM
@{
    ViewData["Title"] = Model.Item.Ad;
    var item = Model.Item;
}

<div class="container py-4">

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Ana Sayfa</a></li>
            <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index" asp-fragment="menu">Menü</a></li>
            <li class="breadcrumb-item active" aria-current="page">@item.Ad</li>
        </ol>
    </nav>

    <div class="row g-4">
        <!-- Görsel -->
        <div class="col-lg-6">
            <div class="ratio ratio-16x9 border rounded overflow-hidden">
                <img class="w-100 h-100 object-fit-cover"
                     src="@Url.Content($"~/img/menu/{item.MenuOgeleriId}.png")"
                     data-id="@item.MenuOgeleriId"
                     alt="@item.Ad"
                     onerror="imgFallback(this)" />
            </div>
        </div>

        <!-- Bilgiler -->
        <div class="col-lg-6">
            <h2 class="fw-bold">@item.Ad</h2>
            <div class="fs-4 text-primary mb-2">@(((decimal?)item.BirimFiyat ?? 0m).ToString("c"))</div>
            <p class="text-muted">@((string.IsNullOrWhiteSpace(item.Aciklama) ? "Premium sunum; şef dokunuşuyla." : item.Aciklama))</p>

            <form class="d-flex align-items-center gap-2 mb-3" method="post" asp-controller="Siparis" asp-action="Ekle">
                <input type="hidden" name="id" value="@item.MenuOgeleriId" />
                <label class="form-label m-0">Adet</label>
                <input type="number" class="form-control" name="adet" value="1" min="1" style="max-width:90px" />
                <button class="btn btn-primary">Sepete Ekle</button>
                <a class="btn btn-outline-secondary" asp-controller="Home" asp-action="Index" asp-fragment="menu">Menüye Dön</a>
            </form>

            <div class="d-flex flex-wrap gap-2">
                <span class="badge rounded-pill text-bg-light">⚡ Hızlı teslim</span>
                <span class="badge rounded-pill text-bg-light">🧼 Hijyen</span>
                <span class="badge rounded-pill text-bg-light">🥗 Diyet seçenekleri</span>
            </div>
        </div>
    </div>

    <!-- Benzer Ürünler -->
    <hr class="my-4" />
    <h5 class="mb-3">Benzer Ürünler</h5>

    <div class="row g-4">
        @foreach (var m in Model.Similar)
        {
            var slug = (m.Ad ?? "")
            .ToLowerInvariant()
            .Replace(" ", "-")
            .Replace("/", "-")
            .Replace(".", "-");

            <div class="col-12 col-sm-6 col-lg-4">
                <div class="card h-100 shadow-sm position-relative">
                    <a class="ratio ratio-16x9 rounded-top overflow-hidden d-block"
                       asp-controller="Menu" asp-action="Details"
                       asp-route-id="@m.MenuOgeleriId" asp-route-slug="@slug">
                        <img class="object-fit-cover w-100 h-100"
                             src="@Url.Content($"~/img/menu/{m.MenuOgeleriId}.png")"
                             data-id="@m.MenuOgeleriId"
                             alt="@m.Ad"
                             onerror="imgFallback(this)" />
                    </a>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <h6 class="m-0 pe-2">@m.Ad</h6>
                            <span class="badge text-bg-light">@(((decimal?)m.BirimFiyat ?? 0m).ToString("c"))</span>
                        </div>
                        <p class="text-muted small mb-2">@(string.IsNullOrWhiteSpace(m.Aciklama) ? "Şefimizin özel tarifi." : m.Aciklama)</p>
                        <a class="btn btn-sm btn-outline-primary"
                           asp-controller="Siparis" asp-action="Ekle" asp-route-id="@m.MenuOgeleriId">Sepete Ekle</a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<script>
    // PNG -> JPG -> placeholder fallback
    function imgFallback(img){
      const id = img.getAttribute('data-id');
      const tried = img.getAttribute('data-try') || 'png';
      if (tried === 'png'){
        img.setAttribute('data-try','jpg');
        img.src = `/img/menu/${id}.jpg`;
      } else {
        img.onerror = null;
        img.src = `/img/placeholder-food.jpg`;
      }
    }
</script>
